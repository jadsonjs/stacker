/*
 * Federal University of Rio Grande do Norte
 * Department of Informatics and Applied Mathematics
 * Collaborative & Automated Software Engineering (CASE) Research Group
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 *
 * stacker
 * br.com.case_.stacker.rules
 * RealTest
 * 17/11/19
 */
package br.ufrn.case_.stacker.rules;

import br.ufrn.case_.stacker.rules.Rule0;
import br.ufrn.case_.stacker.rules.Rule1;
import br.ufrn.case_.stacker.rules.SimplificationChain;
import org.junit.Assert;
import org.junit.Test;

/**
 * Real test with real and completes stack trace
 *
 * Jadson Santos - jadsonjs@gmail.com
 */
public class RealAndCompleteTest {

    String st1 = "\"\"javax.servlet.servletexception: /graduacao/matricula/include/turmas_escolhidas.jsp(276,4) '#{matriculagraduacao.turmasagendamodel}' error reading 'turmasagendamodel' on type br.com.system.ensino.graduacao.jsf.matriculagraduacaombean\n\tat javax.faces.webapp.facesservlet.service(facesservlet.java:277)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:290)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat org.ajax4jsf.webapp.basexmlfilter.doxmlfilter(basexmlfilter.java:206)\n\tat org.ajax4jsf.webapp.basefilter.handlerequest(basefilter.java:290)\n\tat org.ajax4jsf.webapp.basefilter.processuploadsandhandlerequest(basefilter.java:388)\n\tat org.ajax4jsf.webapp.basefilter.dofilter(basefilter.java:515)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat com.ocpsoft.pretty.prettyfilter.dofilter(prettyfilter.java:74)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat br.com.arq.web.viewfilter.dofilter(viewfilter.java:304)\n\tat br.com.arq.web.systemviewfilter.dofilter(systemviewfilter.java:36)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat br.com.arq.log.legacy.core.geradorhashidentificacaologfilter.dofilter(geradorhashidentificacaologfilter.java:50)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat org.apache.myfaces.webapp.filter.extensionsfilter.dofilter(extensionsfilter.java:147)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat br.com.arq.seguranca.filtros.antisqlfilter.dofilter(antisqlfilter.java:114)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat org.jboss.web.tomcat.filters.replyheaderfilter.dofilter(replyheaderfilter.java:96)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat org.apache.catalina.core.standardwrappervalve.invoke(standardwrappervalve.java:235)\n\tat org.apache.catalina.core.standardcontextvalve.invoke(standardcontextvalve.java:191)\n\tat org.jboss.web.tomcat.security.securityassociationvalve.invoke(securityassociationvalve.java:190)\n\tat org.jboss.web.tomcat.security.jacccontextvalve.invoke(jacccontextvalve.java:92)\n\tat org.jboss.web.tomcat.security.securitycontextestablishmentvalve.process(securitycontextestablishmentvalve.java:126)\n\tat org.jboss.web.tomcat.security.securitycontextestablishmentvalve.invoke(securitycontextestablishmentvalve.java:70)\n\tat org.apache.catalina.core.standardhostvalve.invoke(standardhostvalve.java:127)\n\tat org.apache.catalina.valves.errorreportvalve.invoke(errorreportvalve.java:102)\n\tat org.jboss.web.tomcat.service.jca.cachedconnectionvalve.invoke(cachedconnectionvalve.java:158)\n\tat org.apache.catalina.core.standardenginevalve.invoke(standardenginevalve.java:109)\n\tat org.apache.catalina.connector.coyoteadapter.service(coyoteadapter.java:330)\n\tat org.apache.coyote.ajp.ajpprocessor.process(ajpprocessor.java:436)\n\tat org.apache.coyote.ajp.ajpprotocol$ajpconnectionhandler.process(ajpprotocol.java:384)\n\tat org.apache.tomcat.util.net.jioendpoint$worker.run(jioendpoint.java:447)\n\tat java.lang.thread.run(thread.java:745)\ncaused by: org.apache.jasper.el.jspelexception: /graduacao/matricula/include/turmas_escolhidas.jsp(276,4) '#{matriculagraduacao.turmasagendamodel}' error reading 'turmasagendamodel' on type br.com.system.ensino.graduacao.jsf.matriculagraduacaombean\n\tat org.apache.jasper.el.jspvalueexpression.getvalue(jspvalueexpression.java:107)\n\tat org.primefaces.component.schedule.schedule.getvalue(schedule.java:106)\n\tat org.primefaces.component.schedule.schedulerenderer.decode(schedulerenderer.java:45)\n\tat javax.faces.component.uicomponentbase.decode(uicomponentbase.java:789)\n\tat javax.faces.component.uicomponentbase.processdecodes(uicomponentbase.java:1031)\n\tat org.primefaces.component.schedule.schedule.processdecodes(schedule.java:460)\n\tat javax.faces.component.uiform.processdecodes(uiform.java:209)\n\tat org.ajax4jsf.component.ajaxviewroot$1.invokecontextcallback(ajaxviewroot.java:400)\n\tat org.ajax4jsf.component.ajaxviewroot.processphase(ajaxviewroot.java:240)\n\tat org.ajax4jsf.component.ajaxviewroot.processdecodes(ajaxviewroot.java:417)\n\tat com.sun.faces.lifecycle.applyrequestvaluesphase.execute(applyrequestvaluesphase.java:78)\n\tat com.sun.faces.lifecycle.phase.dophase(phase.java:100)\n\tat com.sun.faces.lifecycle.lifecycleimpl.execute(lifecycleimpl.java:118)\n\tat javax.faces.webapp.facesservlet.service(facesservlet.java:265)\n\t... 42 more\ncaused by: java.lang.illegalargumentexception: comparison method violates its general contract!\n\tat java.util.comparabletimsort.mergehi(comparabletimsort.java:835)\n\tat java.util.comparabletimsort.mergeat(comparabletimsort.java:453)\n\tat java.util.comparabletimsort.mergecollapse(comparabletimsort.java:376)\n\tat java.util.comparabletimsort.sort(comparabletimsort.java:182)\n\tat java.util.comparabletimsort.sort(comparabletimsort.java:146)\n\tat java.util.arrays.sort(arrays.java:472)\n\tat java.util.collections.sort(collections.java:155)\n\tat br.com.system.agenda.negocio.agendafactory.createfrom(agendafactory.java:66)\n\tat br.com.system.agenda.negocio.agendafactory.createfrom(agendafactory.java:48)\n\tat br.com.system.ensino.graduacao.jsf.matriculagraduacaombean.getturmasagendamodel(matriculagraduacaombean.java:1095)\n\tat sun.reflect.generatedmethodaccessor3032.invoke(unknown source)\n\tat sun.reflect.delegatingmethodaccessorimpl.invoke(delegatingmethodaccessorimpl.java:43)\n\tat java.lang.reflect.method.invoke(method.java:606)\n\tat javax.el.beanelresolver.getvalue(beanelresolver.java:62)\n\tat javax.el.compositeelresolver.getvalue(compositeelresolver.java:54)\n\tat com.sun.faces.el.facescompositeelresolver.getvalue(facescompositeelresolver.java:72)\n\tat org.apache.el.parser.astvalue.getvalue(astvalue.java:118)\n\tat org.apache.el.valueexpressionimpl.getvalue(valueexpressionimpl.java:186)\n\tat org.apache.jasper.el.jspvalueexpression.getvalue(jspvalueexpression.java:101)\n\t... 55 more\"\"";

    String st2 = "caused by: java.lang.illegalargumentexception: comparison method violates its general contract!\n" +
            "\tat br.com.system.agenda.negocio.agendafactory.createfrom(agendafactory.java)\n" +
            "\tat br.com.system.agenda.negocio.agendafactory.createfrom(agendafactory.java)\n" +
            "\tat br.com.system.ensino.graduacao.jsf.matriculagraduacaombean.getturmasagendamodel(matriculagraduacaombean.java)\n" +
            "caused by: org.apache.jasper.el.jspelexception: /graduacao/matricula/include/turmas_escolhidas.jsp(276,4) '#{matriculagraduacao.turmasagendamodel}' error reading 'turmasagendamodel' on type br.com.system.ensino.graduacao.jsf.matriculagraduacaombean\n";

    String st3 = "\"javax.servlet.servletexception\n\tat javax.faces.webapp.facesservlet.service(facesservlet.java:277)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:290)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat org.ajax4jsf.webapp.basexmlfilter.doxmlfilter(basexmlfilter.java:206)\n\tat org.ajax4jsf.webapp.basefilter.handlerequest(basefilter.java:290)\n\tat org.ajax4jsf.webapp.basefilter.processuploadsandhandlerequest(basefilter.java:388)\n\tat org.ajax4jsf.webapp.basefilter.dofilter(basefilter.java:515)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat com.ocpsoft.pretty.prettyfilter.dofilter(prettyfilter.java:71)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat br.com.arq.web.viewfilter.dofilter(viewfilter.java:301)\n\tat br.com.arq.web.systemviewfilter.dofilter(systemviewfilter.java:36)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat br.com.arq.log.legacy.core.geradorhashidentificacaologfilter.dofilter(geradorhashidentificacaologfilter.java:50)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat org.apache.myfaces.webapp.filter.extensionsfilter.dofilter(extensionsfilter.java:147)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat br.com.arq.filtros.xss.xssfilter.dofilter(xssfilter.java:59)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat br.com.arq.seguranca.filtros.antisqlfilter.dofilter(antisqlfilter.java:100)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat org.jasig.cas.client.session.singlesignoutfilter.dofilter(singlesignoutfilter.java:100)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat org.springframework.security.web.filterchainproxy$virtualfilterchain.dofilter(filterchainproxy.java:316)\n\tat org.springframework.security.web.access.intercept.filtersecurityinterceptor.invoke(filtersecurityinterceptor.java:126)\n\tat org.springframework.security.web.access.intercept.filtersecurityinterceptor.dofilter(filtersecurityinterceptor.java:90)\n\tat org.springframework.security.web.filterchainproxy$virtualfilterchain.dofilter(filterchainproxy.java:330)\n\tat org.springframework.security.web.access.exceptiontranslationfilter.dofilter(exceptiontranslationfilter.java:114)\n\tat org.springframework.security.web.filterchainproxy$virtualfilterchain.dofilter(filterchainproxy.java:330)\n\tat org.springframework.security.web.session.sessionmanagementfilter.dofilter(sessionmanagementfilter.java:122)\n\tat org.springframework.security.web.filterchainproxy$virtualfilterchain.dofilter(filterchainproxy.java:330)\n\tat org.springframework.security.web.authentication.anonymousauthenticationfilter.dofilter(anonymousauthenticationfilter.java:111)\n\tat org.springframework.security.web.filterchainproxy$virtualfilterchain.dofilter(filterchainproxy.java:330)\n\tat org.springframework.security.web.servletapi.securitycontextholderawarerequestfilter.dofilter(securitycontextholderawarerequestfilter.java:168)\n\tat org.springframework.security.web.filterchainproxy$virtualfilterchain.dofilter(filterchainproxy.java:330)\n\tat org.springframework.security.web.savedrequest.requestcacheawarefilter.dofilter(requestcacheawarefilter.java:48)\n\tat org.springframework.security.web.filterchainproxy$virtualfilterchain.dofilter(filterchainproxy.java:330)\n\tat org.springframework.security.web.authentication.www.basicauthenticationfilter.dofilterinternal(basicauthenticationfilter.java:158)\n\tat org.springframework.web.filter.onceperrequestfilter.dofilter(onceperrequestfilter.java:76)\n\tat org.springframework.security.web.filterchainproxy$virtualfilterchain.dofilter(filterchainproxy.java:330)\n\tat org.springframework.security.web.context.securitycontextpersistencefilter.dofilter(securitycontextpersistencefilter.java:91)\n\tat org.springframework.security.web.filterchainproxy$virtualfilterchain.dofilter(filterchainproxy.java:330)\n\tat org.springframework.security.web.filterchainproxy.dofilterinternal(filterchainproxy.java:213)\n\tat org.springframework.security.web.filterchainproxy.dofilter(filterchainproxy.java:176)\n\tat org.springframework.web.filter.delegatingfilterproxy.invokedelegate(delegatingfilterproxy.java:346)\n\tat org.springframework.web.filter.delegatingfilterproxy.dofilter(delegatingfilterproxy.java:259)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat org.springframework.web.filter.characterencodingfilter.dofilterinternal(characterencodingfilter.java:88)\n\tat org.springframework.web.filter.onceperrequestfilter.dofilter(onceperrequestfilter.java:76)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat org.jboss.web.tomcat.filters.replyheaderfilter.dofilter(replyheaderfilter.java:96)\n\tat org.apache.catalina.core.applicationfilterchain.internaldofilter(applicationfilterchain.java:235)\n\tat org.apache.catalina.core.applicationfilterchain.dofilter(applicationfilterchain.java:206)\n\tat org.apache.catalina.core.standardwrappervalve.invoke(standardwrappervalve.java:235)\n\tat org.apache.catalina.core.standardcontextvalve.invoke(standardcontextvalve.java:191)\n\tat org.jboss.web.tomcat.security.securityassociationvalve.invoke(securityassociationvalve.java:190)\n\tat org.jboss.web.tomcat.security.jacccontextvalve.invoke(jacccontextvalve.java:92)\n\tat org.jboss.web.tomcat.security.securitycontextestablishmentvalve.process(securitycontextestablishmentvalve.java:126)\n\tat org.jboss.web.tomcat.security.securitycontextestablishmentvalve.invoke(securitycontextestablishmentvalve.java:70)\n\tat org.apache.catalina.core.standardhostvalve.invoke(standardhostvalve.java:127)\n\tat org.apache.catalina.valves.errorreportvalve.invoke(errorreportvalve.java:102)\n\tat org.jboss.web.tomcat.service.jca.cachedconnectionvalve.invoke(cachedconnectionvalve.java:158)\n\tat org.apache.catalina.core.standardenginevalve.invoke(standardenginevalve.java:109)\n\tat org.apache.catalina.connector.coyoteadapter.service(coyoteadapter.java:330)\n\tat org.apache.coyote.ajp.ajpprocessor.process(ajpprocessor.java:436)\n\tat org.apache.coyote.ajp.ajpprotocol$ajpconnectionhandler.process(ajpprotocol.java:384)\n\tat org.apache.tomcat.util.net.jioendpoint$worker.run(jioendpoint.java:447)\n\tat java.lang.thread.run(thread.java:745)\ncaused by: java.lang.nullpointerexception\n\tat com.ocpsoft.pretty.prettycontext.stripcontextpath(prettycontext.java:236)\n\tat com.ocpsoft.pretty.prettycontext.isprettyrequest(prettycontext.java:218)\n\tat com.ocpsoft.pretty.application.prettyviewhandler.getactionurl(prettyviewhandler.java:64)\n\tat org.ajax4jsf.application.viewhandlerwrapper.getactionurl(viewhandlerwrapper.java:86)\n\tat com.sun.faces.renderkit.html_basic.formrenderer.getactionstr(formrenderer.java:195)\n\tat com.sun.faces.renderkit.html_basic.formrenderer.encodebegin(formrenderer.java:127)\n\tat javax.faces.component.uicomponentbase.encodebegin(uicomponentbase.java:813)\n\tat javax.faces.component.uicomponent.encodeall(uicomponent.java:928)\n\tat javax.faces.component.uicomponent.encodeall(uicomponent.java:933)\n\tat com.sun.faces.application.viewhandlerimpl.dorenderview(viewhandlerimpl.java:266)\n\tat com.sun.faces.application.viewhandlerimpl.renderview(viewhandlerimpl.java:197)\n\tat com.ocpsoft.pretty.application.prettyviewhandler.renderview(prettyviewhandler.java:83)\n\tat org.ajax4jsf.application.viewhandlerwrapper.renderview(viewhandlerwrapper.java:100)\n\tat org.ajax4jsf.application.ajaxviewhandler.renderview(ajaxviewhandler.java:176)\n\tat com.sun.faces.lifecycle.renderresponsephase.execute(renderresponsephase.java:110)\n\tat com.sun.faces.lifecycle.phase.dophase(phase.java:100)\n\tat com.sun.faces.lifecycle.lifecycleimpl.render(lifecycleimpl.java:139)\n\tat javax.faces.webapp.facesservlet.service(facesservlet.java:266)\n\t... 77 more\"";

    String st4 = "caused by: java.lang.nullpointerexception\n" +
            "\tat com.ocpsoft.pretty.prettycontext.stripcontextpath(prettycontext.java)\n" +
            "\tat com.ocpsoft.pretty.prettycontext.isprettyrequest(prettycontext.java)\n" +
            "\tat com.ocpsoft.pretty.application.prettyviewhandler.getactionurl(prettyviewhandler.java)\n" +
            "\tat org.ajax4jsf.application.viewhandlerwrapper.getactionurl(viewhandlerwrapper.java)\n" +
            "\tat com.sun.faces.renderkit.html_basic.formrenderer.getactionstr(formrenderer.java)\n" +
            "\tat com.sun.faces.renderkit.html_basic.formrenderer.encodebegin(formrenderer.java)\n" +
            "\tat javax.faces.component.uicomponentbase.encodebegin(uicomponentbase.java)\n" +
            "\tat javax.faces.component.uicomponent.encodeall(uicomponent.java)\n" +
            "\tat javax.faces.component.uicomponent.encodeall(uicomponent.java)\n" +
            "\tat com.sun.faces.application.viewhandlerimpl.dorenderview(viewhandlerimpl.java)\n" +
            "\tat com.sun.faces.application.viewhandlerimpl.renderview(viewhandlerimpl.java)\n" +
            "\tat com.ocpsoft.pretty.application.prettyviewhandler.renderview(prettyviewhandler.java)\n" +
            "\tat org.ajax4jsf.application.viewhandlerwrapper.renderview(viewhandlerwrapper.java)\n" +
            "\tat org.ajax4jsf.application.ajaxviewhandler.renderview(ajaxviewhandler.java)\n" +
            "\tat com.sun.faces.lifecycle.renderresponsephase.execute(renderresponsephase.java)\n" +
            "\tat com.sun.faces.lifecycle.phase.dophase(phase.java)\n" +
            "\tat com.sun.faces.lifecycle.lifecycleimpl.render(lifecycleimpl.java)\n" +
            "\tat javax.faces.webapp.facesservlet.service(facesservlet.java)\n";

    @Test
    public void isSimplificationRealAndCompleteStackTrace() {

        SimplificationChain chainSimplification = new Rule1(true, "br.com.system").setNext(new Rule0());

        String result = chainSimplification.execute(st1);

        Assert.assertEquals(st2, result);

    }

    @Test
    public void isSimplificationRealAndCompleteStackTrace2() {

        SimplificationChain chainSimplification = new Rule1(true, "").setNext(new Rule0());

        String result = chainSimplification.execute(st3);

        Assert.assertEquals(st4, result);

    }

}
